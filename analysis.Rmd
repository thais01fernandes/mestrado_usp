---
title: Exploratory Analysis of Municipalities in Brazil that have adopted a Fare Free
  Public Transport
author: "Thais Pereira"
date: "`r format(Sys.Date(), format='%d/%m/%Y')`"
output:
  html_document:
    toc: yes
    toc_float: yes
  df_print: default
---

```{r setup, include=FALSE}

(knitr::opts_chunk$set(
	echo = FALSE,
	error = FALSE,
	message = FALSE,
	warning = FALSE
)
) 
```

```{css}

@import url('https://fonts.googleapis.com/css2?family=Lora:wght@500&display=swap');

h1.title{ 
    font-family: 'Lora', serif;
    color: #bf7d70;
    font-size: 30px;
    text-align: center;
    font-weight: bold;
}

h2 {
  font-family: 'Lora', serif;
  font-size: 15px;
  text-align: justify;
}

h4.author{ 
    font-family: 'Lora', serif;
    color: #bf7d70;
    font-size: 20px;
    text-align: center;
    font-weight: bold;
}

h4.date{ 
    font-family: 'Lora', serif;
    color: #bf7d70;
    font-size: 12px;
    text-align: center;
    font-weight: bold;
}

p{
  font-family: 'Lora', serif;
  text-align: justify;
  font-size: 13px
}

.btn {
    border-width: 0 0px 0px 0px;
    font-weight: normal;
    text-transform: ;
}
.btn-default {
    color: #2ecc71;
    background-color: #ffffff;
    border-color: #ffffff;
}


h1, .h1, h2, .h2, h3, .h3 , h4, .h4, h5, .h5, h6, .h6, h7, .h7, h8, .h8 {
    margin-top: 40px;
}


```


```{r Pacotes}


library("tidyverse")
library("kableExtra")
library("knitr")
library("tidylog")
library("readxl")
library("geobr")
library("sf")
library("wesanderson")
library("ggplot2")
library("stringr")
library ("abjData")
library("extrafont")
library("lubridate")
library("transformr")
library("reactable")
library("rnaturalearth")
library("rgeos")
library("plotly")
library("ggrepel")
library('googlesheets4')
library("leaflet")
library('ggthemes')
library('rmdformats')


```


```{r Baixando os dados}

file1 <- "https://raw.githubusercontent.com/thais01fernandes/mestrado_usp/main/dados/banco_completo"
banco_completo <- read_delim(file1, delim = ",", 
                        locale = locale(encoding='latin1')) %>% select(-1)


```


## 1. Tabela com dados a respeio dos municípios que implementaram a política até março de 2023

```{r Tabela inicial, fig.align = 'center', out.width = "60%"}

# tabela de apresentação dos municípios estudados 
# tabela com reactable: 
  
  options(scipen=999)
  banco_completo  %>% 
  filter(tarifa_zero == "sim") %>% 
  select(nome_da_uf, 
         nome_do_municipio, 
         classe_pop, 
         produto_interno_bruto_a_precos_correntes_r_1_000,
         produto_interno_bruto_per_capita_a_precos_correntes_r_1_00, 
         pmpob, prosperidade_social,  
         taxa_urbanizacao, 
         ar_mun_2022, 
         densidade_demografica, 
         gini, 
         theil, 
         idhm_class, 
         idhm_e_class, 
         idhm_r_class, 
         idhm_l_class, 
         ivs_class, 
         ivs_infra_urbana_class, 
         ivs_cap_class, 
         ivs_renda_trab_class) %>% 
  mutate_if(is.character, str_to_title) %>% 
  mutate(pmpob = pmpob/100) %>% 
  reactable(
      defaultPageSize = 5,
      searchable = TRUE,
      outlined = FALSE, 
      showPageInfo = TRUE, 
      showPageSizeOptions = TRUE,
      defaultColDef = colDef(
      align = "center",
      headerStyle = list(background = "#d5cabd")),
      columns = list(
      nome_da_uf = colDef("Federative Unit", minWidth = 105, align = "center"),
      nome_do_municipio = colDef("City", minWidth = 120, align = "center"),
      classe_pop = colDef("Population Class",  minWidth = 120, align = "center"),
      produto_interno_bruto_a_precos_correntes_r_1_000 = colDef("GDP" , format = colFormat(prefix = "R$ ", separators = TRUE), minWidth = 120),
      produto_interno_bruto_per_capita_a_precos_correntes_r_1_00 = colDef("GDP Per Capta Income" , format = colFormat(prefix = "R$ ", separators = TRUE), minWidth = 150),
      prosperidade_social = colDef("Social Prosperity", minWidth = 130),
      pmpob = colDef("% of Poor" ,  format = colFormat(percent = TRUE, digits = 1), minWidth = 120), 
      taxa_urbanizacao = colDef("Urbanization Rate" , format = colFormat(percent = TRUE, digits = 1), minWidth = 120),
      gini = colDef("Gini" ,  minWidth = 100),
      theil = colDef("Theil-L" ,  minWidth = 100),
      idhm_class = colDef("Municipal Human Development Index (MHDI)" ,  minWidth = 150),
      idhm_e_class = colDef("MHDI Education" ,  minWidth = 100),
      idhm_r_class = colDef("MHDI Income" ,  minWidth = 100), 
      idhm_l_class  = colDef("MHDI Longevidade" , minWidth = 120),
      ivs_class = colDef("Social Vulnerability Index (SVI)" , minWidth = 150), 
      ivs_infra_urbana_class = colDef("SVI Urban Infrastructure" , minWidth = 150), 
      ivs_cap_class = colDef("SVI Human Capital" , minWidth = 150), 
      ivs_renda_trab_class = colDef("SVI Income and Work" , minWidth = 150), 
      ar_mun_2022 = colDef("Territorial Area" , format = colFormat(suffix = " km²", separators = TRUE), minWidth = 150),
      densidade_demografica = colDef("Demographic Density" , format = colFormat(suffix = " hab/km²", separators = TRUE, digits = 3), minWidth = 150),
      pageSizeOptions = c(5,10,15,20,25,30), bordered = TRUE, striped = FALSE, highlight = TRUE))
     
```

## 2. Localização dos municípios

```{r Download GEObr, include=FALSE}

# Download dos Estados e Municípios: 

muni_geobr_1 <- read_municipality(code_muni="all", year=2018)

geo_ufs <- read_state(code_state = 'all', year = 2018)

# Estados: 

  munic_isencao_tarifa_uf <- banco_completo %>% 
  select(cod_uf,tarifa_zero) %>% 
  distinct() %>% 
  rename(code_state=cod_uf)

  geo_ufs_2 <- geo_ufs  %>% 
  left_join(munic_isencao_tarifa_uf, by = c("code_state")) %>% 
  replace(is.na("tarifa_zero"), "não")

# municipios: 

  munic_isencao_tarifa_muni <- banco_completo %>% 
  rename(code_muni= CodMun) %>% 
  select(code_muni,tarifa_zero) %>% 
  distinct()

  muni_geobr_3 <- muni_geobr_1 %>% 
  left_join(munic_isencao_tarifa_muni, by = c("code_muni")) %>% 
  replace(is.na("tarifa_zero"), "não") %>% 
  st_centroid() %>% 
  filter(tarifa_zero == "sim") %>% 
  rename (Municipio = name_muni)

```







